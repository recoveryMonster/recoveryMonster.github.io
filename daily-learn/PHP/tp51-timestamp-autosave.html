<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>tp5.1通过模型实现时间戳自动写入 | 城南花已开</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/assets/logo.ico">
    <meta name="description" content="所爱隔山海，城南花已开">
    
    <link rel="preload" href="/assets/css/0.styles.6b9be157.css" as="style"><link rel="preload" href="/assets/js/app.cbc27ffd.js" as="script"><link rel="preload" href="/assets/js/2.26d918e1.js" as="script"><link rel="preload" href="/assets/js/28.c9b99067.js" as="script"><link rel="prefetch" href="/assets/js/10.8324ee53.js"><link rel="prefetch" href="/assets/js/11.b3fae781.js"><link rel="prefetch" href="/assets/js/12.2f57424d.js"><link rel="prefetch" href="/assets/js/13.a1bd9044.js"><link rel="prefetch" href="/assets/js/14.a21b9547.js"><link rel="prefetch" href="/assets/js/15.a55f5787.js"><link rel="prefetch" href="/assets/js/16.69ae7d01.js"><link rel="prefetch" href="/assets/js/17.8305f7c6.js"><link rel="prefetch" href="/assets/js/18.5f682b15.js"><link rel="prefetch" href="/assets/js/19.a8e0ad12.js"><link rel="prefetch" href="/assets/js/20.d64b0ffc.js"><link rel="prefetch" href="/assets/js/21.bb3d1ce8.js"><link rel="prefetch" href="/assets/js/22.2807caaf.js"><link rel="prefetch" href="/assets/js/23.d7d23893.js"><link rel="prefetch" href="/assets/js/24.d84de391.js"><link rel="prefetch" href="/assets/js/25.028292c4.js"><link rel="prefetch" href="/assets/js/26.e48e58fe.js"><link rel="prefetch" href="/assets/js/27.81a50ac9.js"><link rel="prefetch" href="/assets/js/29.3e398b0e.js"><link rel="prefetch" href="/assets/js/3.bf921ca6.js"><link rel="prefetch" href="/assets/js/30.eda8afc0.js"><link rel="prefetch" href="/assets/js/31.4df929c1.js"><link rel="prefetch" href="/assets/js/32.883b799d.js"><link rel="prefetch" href="/assets/js/33.edff820f.js"><link rel="prefetch" href="/assets/js/34.a40dfb52.js"><link rel="prefetch" href="/assets/js/35.f84b2527.js"><link rel="prefetch" href="/assets/js/36.d9686c50.js"><link rel="prefetch" href="/assets/js/37.7e04f937.js"><link rel="prefetch" href="/assets/js/38.7e0cf189.js"><link rel="prefetch" href="/assets/js/39.06edca1d.js"><link rel="prefetch" href="/assets/js/4.01616d0a.js"><link rel="prefetch" href="/assets/js/40.556d0c76.js"><link rel="prefetch" href="/assets/js/41.9370ec30.js"><link rel="prefetch" href="/assets/js/42.efb2b09e.js"><link rel="prefetch" href="/assets/js/43.230fd681.js"><link rel="prefetch" href="/assets/js/44.f8baf234.js"><link rel="prefetch" href="/assets/js/45.9434cbfb.js"><link rel="prefetch" href="/assets/js/46.5ceab43d.js"><link rel="prefetch" href="/assets/js/47.49c5f096.js"><link rel="prefetch" href="/assets/js/48.94111e03.js"><link rel="prefetch" href="/assets/js/49.b430e466.js"><link rel="prefetch" href="/assets/js/5.103b1fc9.js"><link rel="prefetch" href="/assets/js/50.5576e684.js"><link rel="prefetch" href="/assets/js/51.868924b4.js"><link rel="prefetch" href="/assets/js/52.13030538.js"><link rel="prefetch" href="/assets/js/53.d14e23b5.js"><link rel="prefetch" href="/assets/js/54.692ba555.js"><link rel="prefetch" href="/assets/js/55.e7f4ee2b.js"><link rel="prefetch" href="/assets/js/56.b2192bd2.js"><link rel="prefetch" href="/assets/js/57.7f33c3ce.js"><link rel="prefetch" href="/assets/js/58.bebb810c.js"><link rel="prefetch" href="/assets/js/59.3bb5c8e3.js"><link rel="prefetch" href="/assets/js/6.8d2cb690.js"><link rel="prefetch" href="/assets/js/60.f7d443a1.js"><link rel="prefetch" href="/assets/js/61.03c84be3.js"><link rel="prefetch" href="/assets/js/62.4d23f330.js"><link rel="prefetch" href="/assets/js/63.9b7eb6eb.js"><link rel="prefetch" href="/assets/js/64.c9a3f7a5.js"><link rel="prefetch" href="/assets/js/65.f18871f6.js"><link rel="prefetch" href="/assets/js/66.3d2c74a6.js"><link rel="prefetch" href="/assets/js/67.df9620fc.js"><link rel="prefetch" href="/assets/js/68.4c78fe6f.js"><link rel="prefetch" href="/assets/js/69.5298627a.js"><link rel="prefetch" href="/assets/js/7.77ce0fba.js"><link rel="prefetch" href="/assets/js/70.269c5ebf.js"><link rel="prefetch" href="/assets/js/71.14b994cb.js"><link rel="prefetch" href="/assets/js/72.6e1a94ad.js"><link rel="prefetch" href="/assets/js/73.327ce2fa.js"><link rel="prefetch" href="/assets/js/74.9535cbd0.js"><link rel="prefetch" href="/assets/js/8.a85b50e1.js"><link rel="prefetch" href="/assets/js/9.f7ed37b4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6b9be157.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/logo.png" alt="城南花已开" class="logo"> <span class="site-name can-hide">城南花已开</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="日常积累" class="dropdown-title"><span class="title">日常积累</span> <span class="arrow down"></span></button> <button type="button" aria-label="日常积累" class="mobile-dropdown-title"><span class="title">日常积累</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daily-learn/JavaScript/call-apply-bind-simulator.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/daily-learn/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/daily-learn/CSS/make-talkbubble.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/daily-learn/PHP/tp51-timestamp-autosave.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  PHP
</a></li><li class="dropdown-item"><!----> <a href="/daily-learn/Git/git-des.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/daily-learn/Scaffold/Introduction.html" class="nav-link">
  Scaffold
</a></li></ul></div></div><div class="nav-item"><a href="/cs-basic/" class="nav-link">
  计算机基础
</a></div><div class="nav-item"><a href="/translation/Arrays-symbols-and-realms.html" class="nav-link">
  外文翻译
</a></div> <a href="https://github.com/recoveryMonster" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="日常积累" class="dropdown-title"><span class="title">日常积累</span> <span class="arrow down"></span></button> <button type="button" aria-label="日常积累" class="mobile-dropdown-title"><span class="title">日常积累</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daily-learn/JavaScript/call-apply-bind-simulator.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/daily-learn/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/daily-learn/CSS/make-talkbubble.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/daily-learn/PHP/tp51-timestamp-autosave.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  PHP
</a></li><li class="dropdown-item"><!----> <a href="/daily-learn/Git/git-des.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/daily-learn/Scaffold/Introduction.html" class="nav-link">
  Scaffold
</a></li></ul></div></div><div class="nav-item"><a href="/cs-basic/" class="nav-link">
  计算机基础
</a></div><div class="nav-item"><a href="/translation/Arrays-symbols-and-realms.html" class="nav-link">
  外文翻译
</a></div> <a href="https://github.com/recoveryMonster" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>PHP</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/daily-learn/PHP/tp51-timestamp-autosave.html" aria-current="page" class="active sidebar-link">tp5.1通过模型实现时间戳自动写入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily-learn/PHP/tp51-timestamp-autosave.html#配置方式" class="sidebar-link">配置方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily-learn/PHP/tp51-timestamp-autosave.html#全局配置" class="sidebar-link">全局配置</a></li><li class="sidebar-sub-header"><a href="/daily-learn/PHP/tp51-timestamp-autosave.html#单独配置" class="sidebar-link">单独配置</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily-learn/PHP/tp51-timestamp-autosave.html#添加数据实现时间戳自动写入" class="sidebar-link">添加数据实现时间戳自动写入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily-learn/PHP/tp51-timestamp-autosave.html#create-方式-推荐" class="sidebar-link">create()方式（推荐）</a></li><li class="sidebar-sub-header"><a href="/daily-learn/PHP/tp51-timestamp-autosave.html#save-方法" class="sidebar-link">save()方法</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily-learn/PHP/tp51-timestamp-autosave.html#静态调用还是实例调用" class="sidebar-link">静态调用还是实例调用？</a></li><li class="sidebar-sub-header"><a href="/daily-learn/PHP/tp51-timestamp-autosave.html#查询数据实现update-time时间写入" class="sidebar-link">查询数据实现update_time时间写入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily-learn/PHP/tp51-timestamp-autosave.html#查询数据的方法" class="sidebar-link">查询数据的方法：</a></li><li class="sidebar-sub-header"><a href="/daily-learn/PHP/tp51-timestamp-autosave.html#save-方法进行更新数据" class="sidebar-link">save()方法进行更新数据</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily-learn/PHP/tp51-timestamp-autosave.html#更新数据实现时间戳自动写入" class="sidebar-link">更新数据实现时间戳自动写入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily-learn/PHP/tp51-timestamp-autosave.html#update-方法-推荐" class="sidebar-link">update()方法(推荐)</a></li><li class="sidebar-sub-header"><a href="/daily-learn/PHP/tp51-timestamp-autosave.html#save-方法-2" class="sidebar-link">save()方法</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily-learn/PHP/tp51-timestamp-autosave.html#软删除实现时间戳自动写入" class="sidebar-link">软删除实现时间戳自动写入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily-learn/PHP/tp51-timestamp-autosave.html#destory-方法-推荐" class="sidebar-link">destory()方法（推荐）</a></li><li class="sidebar-sub-header"><a href="/daily-learn/PHP/tp51-timestamp-autosave.html#delete-方法" class="sidebar-link">delete()方法</a></li><li class="sidebar-sub-header"><a href="/daily-learn/PHP/tp51-timestamp-autosave.html#获取数据" class="sidebar-link">获取数据</a></li><li class="sidebar-sub-header"><a href="/daily-learn/PHP/tp51-timestamp-autosave.html#恢复被软删除的数据" class="sidebar-link">恢复被软删除的数据</a></li></ul></li></ul></li><li><a href="/daily-learn/PHP/typedance-pay-mini.html" class="sidebar-link">php字节跳动小程序支付</a></li><li><a href="/daily-learn/PHP/tecent-SMS-verify.html" class="sidebar-link">腾讯短信验证Api</a></li><li><a href="/daily-learn/PHP/restore-mysql-by-history.html" class="sidebar-link">通过历史data文件目录恢复数据库</a></li><li><a href="/daily-learn/PHP/wx-tp-fullstack/first.html" class="sidebar-link">微信小程序商城构建全栈应用</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Scaffold</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tp5-1通过模型实现时间戳自动写入"><a href="#tp5-1通过模型实现时间戳自动写入" class="header-anchor">#</a> tp5.1通过模型实现时间戳自动写入</h1> <p>因为Db是模型的基石，模型的内部最终还是要依赖Db来完成对数据库的访问等操作，所以模型可以操作Db的方法，而Db不能操作模型的方法。</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment"># 非必须</span>
<span class="token keyword">protected</span> <span class="token variable">$pk</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'uid'</span><span class="token punctuation">;</span> <span class="token comment"># 设置主键名称</span>
<span class="token keyword">protected</span> <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'think_user'</span><span class="token punctuation">;</span> <span class="token comment">#设置当前模型对应的完整数据表名称</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="配置方式"><a href="#配置方式" class="header-anchor">#</a> 配置方式</h2> <h3 id="全局配置"><a href="#全局配置" class="header-anchor">#</a> 全局配置</h3> <p>该时间戳自动写入默认为false,如果要进行全局配置，只需在database.php文件中开启即可。</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// 自动写入时间戳字段</span>
<span class="token string single-quoted-string">'auto_timestamp'</span>  <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>当create_time和update_time两个字段不为int时，可以进行如下设置：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// 开启自动写入时间戳字段   支持字段类型包括timestamp/datetime/int</span>
<span class="token string single-quoted-string">'auto_timestamp'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'datetime'</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>默认时间字段格式化输出，输出格式为 ‘Y-m-d H:i:s’，可以自行在database.php配置文件中进行修改为false或输出格式：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// 时间字段取出后的默认时间格式</span>
    <span class="token string single-quoted-string">'datetime_format'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Y-m-d H:i:s'</span><span class="token punctuation">,</span>
<span class="token comment">//改为false 或自定义输出格式</span>
<span class="token string single-quoted-string">'datetime_format'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">false</span><span class="token operator">/</span><span class="token string single-quoted-string">'Y/m/d H:i'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>也可以在model中设置</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code> <span class="token keyword">protected</span> <span class="token variable">$dateFormat</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Y/m/d H:i'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="单独配置"><a href="#单独配置" class="header-anchor">#</a> 单独配置</h3> <p>全局的时间戳自动写入设置为false,在相应的模型中开启时间戳写入，</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code> <span class="token keyword">protected</span> <span class="token variable">$autoWriteTimestamp</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">//或者设置时间格式</span>
    <span class="token comment">// protected $autoWriteTimestamp = 'datatime';</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果只需要create_time而不需要update_time，则可以在model中关闭update_time</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>  <span class="token comment">// 关闭自动写入update_time字段</span>
    <span class="token keyword">protected</span> <span class="token variable">$updateTime</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如果数据表中的字段名 不是create_time 和 update_time 则需在model中申明他们的属性，</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">//如：</span>
    <span class="token keyword">protected</span> <span class="token variable">$createTime</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my_create_time_filed'</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$updateTime</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'my_careate_time_field'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="添加数据实现时间戳自动写入"><a href="#添加数据实现时间戳自动写入" class="header-anchor">#</a> 添加数据实现时间戳自动写入</h2> <h3 id="create-方式-推荐"><a href="#create-方式-推荐" class="header-anchor">#</a> create()方式（推荐）</h3> <p>使用模型中的create()方法，实现时间戳的自动写入，并返回插入字段的数组信息，此方法为<strong>静态调用</strong>：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$register</span> <span class="token operator">=</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//添加数据</span>
    <span class="token function">halt</span><span class="token punctuation">(</span><span class="token variable">$register</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//打印数据</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>结果如下：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token argument-name">D</span><span class="token punctuation">:</span>\<span class="token constant">UPUPW_AP7</span><span class="token number">.2</span>_64\vhosts\xdd\think\thinkphp\library\think\Debug<span class="token operator">.</span><span class="token argument-name">php</span><span class="token punctuation">:</span><span class="token number">226</span><span class="token punctuation">:</span>
<span class="token keyword">array</span> <span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token string single-quoted-string">'username'</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">string</span> <span class="token string single-quoted-string">'aa'</span> <span class="token punctuation">(</span>length<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token string single-quoted-string">'pwd'</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">string</span> <span class="token string single-quoted-string">'d93a5def7511da3d0f2d171d9c344e91'</span> <span class="token punctuation">(</span>length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
  <span class="token string single-quoted-string">'phone'</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">string</span> <span class="token string single-quoted-string">'13623457891'</span> <span class="token punctuation">(</span>length<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">)</span>
  <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">string</span> <span class="token string single-quoted-string">'2'</span> <span class="token punctuation">(</span>length<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>当post数组中的非数据表字段数据时，create()方法只将数据表中的字段进行添加，但返回的结果中包含非数据表中的字段值（这里使用了）：</p> <p><img src="https://raw.githubusercontent.com/recoveryMonster/HexoImages/master/img/modelcreate.png" alt=""></p> <h3 id="save-方法"><a href="#save-方法" class="header-anchor">#</a> save()方法</h3> <p>save()进行添加数据，也可实现时间戳的自动写入，返回结果为boolean值，此方法需<strong>实例化调用</strong>：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">app<span class="token punctuation">\</span>api<span class="token punctuation">\</span>model<span class="token punctuation">\</span>User</span> <span class="token keyword">as</span> UserModel<span class="token punctuation">;</span>
<span class="token comment">//获得input上传的全部信息</span>
<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">input</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'post.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$user</span> <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">UserModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$result</span><span class="token operator">=</span><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">halt</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>结果如下：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token argument-name">D</span><span class="token punctuation">:</span>\<span class="token constant">UPUPW_AP7</span><span class="token number">.2</span>_64\vhosts\xdd\think\thinkphp\library\think\Debug<span class="token operator">.</span><span class="token argument-name">php</span><span class="token punctuation">:</span><span class="token number">226</span><span class="token punctuation">:</span>boolean <span class="token constant boolean">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>还可以用链式操作<strong>allowField()方法</strong>，过滤post数组中非数据表中的字段</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// 过滤post数组中的非数据表字段数据</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">allowField</span><span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">allowField</span><span class="token punctuation">(</span><span class="token punctuation">[</span>要插入的字段<span class="token punctuation">,</span>要插入的字段<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 添加多条记录</span>
<span class="token variable">$user</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token variable">$list</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'thinkphp'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'email'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'thinkphp@qq.com'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'onethink'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'email'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'onethink@qq.com'</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">saveAll</span><span class="token punctuation">(</span><span class="token variable">$list</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>虽然模型类也能使用DB中的insert()方法进行添加数据，但不会实现时间戳的自动写入，所以这里不再赘述。</p> <h2 id="静态调用还是实例调用"><a href="#静态调用还是实例调用" class="header-anchor">#</a> 静态调用还是实例调用？</h2> <p>框架推荐静态调用，第一个原因，静态调用的方法更为简洁；第二个原因,从模型的本质意义讨论，你实例化出模型对象后该对象才会对应数据表下的记录，只有把类实例化了才能代表一个事物。这里我们先实例化对象就相当于获得一组数据，然后通过数据进行添加数据或获取数据，显得有点不正常。而静态调用，则是把模型当作一个表。添加数据或者获取数据都是在表上完成，这个过程就像数据表添加或查询数据一样，这样比较好理解。这里也只是为了编程逻辑的完整性和合理性，不过还是可以任意选择一种方法进行操作。</p> <h2 id="查询数据实现update-time时间写入"><a href="#查询数据实现update-time时间写入" class="header-anchor">#</a> 查询数据实现update_time时间写入</h2> <p>get和find是一个记录或一个模型对象，all和select则是一组记录或一组模型对象。其中find和select是属于Db类的方法，由于查询数据之后不会自动写入时间戳，因此需要更改字段内容后用save()方法进行更新数据。</p> <h3 id="查询数据的方法"><a href="#查询数据的方法" class="header-anchor">#</a> 查询数据的方法：</h3> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment"># 查询单条记录</span>
<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>；<span class="token comment">//根据主键获取单条记录</span>
<span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'thinkphp'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 查询多条记录</span>
<span class="token variable">$list</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'status'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'asc'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$list</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'status'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">order</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'asc'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 获取某个字段或者某个列的值</span>
<span class="token comment">// 获取某个用户的积分</span>
<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'score'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取某个列的所有值</span>
<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'status'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">column</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 动态查询</span>
<span class="token comment">// 根据name字段查询用户</span>
<span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">getByName</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'thinkphp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="save-方法进行更新数据"><a href="#save-方法进行更新数据" class="header-anchor">#</a> save()方法进行更新数据</h3> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">//更新时间</span>
<span class="token variable">$result</span><span class="token operator">-&gt;</span><span class="token property">update_time</span><span class="token operator">=</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//保存数据</span>
<span class="token variable">$result</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="更新数据实现时间戳自动写入"><a href="#更新数据实现时间戳自动写入" class="header-anchor">#</a> 更新数据实现时间戳自动写入</h2> <h3 id="update-方法-推荐"><a href="#update-方法-推荐" class="header-anchor">#</a> update()方法(推荐)</h3> <p>使用模型的静态update方法进行更新，此时update_time时间戳会自动写入，返回结果为一个数组：</p> <p><code>halt(UserModel::update(['id'=&gt;2,'name'=&gt;'aa']));</code></p> <p>返回结果：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token argument-name">D</span><span class="token punctuation">:</span>\<span class="token constant">UPUPW_AP7</span><span class="token number">.2</span>_64\vhosts\xdd\think\thinkphp\library\think\Debug<span class="token operator">.</span><span class="token argument-name">php</span><span class="token punctuation">:</span><span class="token number">226</span><span class="token punctuation">:</span>
<span class="token keyword">array</span> <span class="token punctuation">(</span>size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">int</span> <span class="token number">2</span>
  <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">string</span> <span class="token string single-quoted-string">'aa'</span> <span class="token punctuation">(</span>length<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token string single-quoted-string">'update_time'</span> <span class="token operator">=&gt;</span> <span class="token keyword type-declaration">string</span> <span class="token string single-quoted-string">'2019-05-21 01:14:23'</span> <span class="token punctuation">(</span>length<span class="token operator">=</span><span class="token number">19</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>使用数据库的更新方法直接更新操作，也可实现时间戳的更新（<strong>注意两种方法的写法</strong>），返回的是受影响的字段数：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token function">halt</span><span class="token punctuation">(</span><span class="token class-name static-context">UserModel</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'='</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'bb'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="save-方法-2"><a href="#save-方法-2" class="header-anchor">#</a> save()方法</h3> <p>save()方法进行更新数据，也可实现时间戳的自动写入，返回结果为boolean值，此方法需<strong>实例化调用</strong>：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment"># 方法1</span>
<span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token class-name type-declaration">find</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">name</span>     <span class="token operator">=</span> <span class="token string single-quoted-string">'thinkphp'</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">email</span>    <span class="token operator">=</span> <span class="token string single-quoted-string">'thinkphp@qq.com'</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 方法2</span>
<span class="token variable">$user</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token comment">// save方法第二个参数为更新条件</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'name'</span>  <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'thinkphp'</span><span class="token punctuation">,</span>
    <span class="token string single-quoted-string">'email'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'thinkphp@qq.com'</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token comment">// 过滤post数组中的非数据表字段数据</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">allowField</span><span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="软删除实现时间戳自动写入"><a href="#软删除实现时间戳自动写入" class="header-anchor">#</a> 软删除实现时间戳自动写入</h2> <p>**软删除仅对模型的删除方法有效，**在数据表中建 (默认) delete_time 字段，默认为null，  记录被删除的时间戳，通过use SoftDelete开启软删除。软删除之后，delete_time为当前时间戳，普通查询数据时则不会查询到此字段。</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>concern<span class="token punctuation">\</span>SoftDelete</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">SoftDelete</span><span class="token punctuation">;</span><span class="token comment">//开启软删除</span>
｝
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>若 想更改默认的delete_time 字段，在model中使用：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>  <span class="token keyword">protected</span> <span class="token variable">$deleteTime</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'delete_tm'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="destory-方法-推荐"><a href="#destory-方法-推荐" class="header-anchor">#</a> destory()方法（推荐）</h3> <p>使用<strong>静态方法</strong>destory()进行软删除时，自动为delete_time添加时间戳，返回的是boolean值，</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">// 软删除</span>
<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 真实删除</span>
<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>返回结果：</p> <p><code>D:\UPUPW_AP7.2_64\vhosts\xdd\think\thinkphp\library\think\Debug.php:226:boolean true</code></p> <p>默认情况下查询的数据不包含软删除数据，如果需要包含软删除的数据，可以使用下面的方式查询：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">withTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">withTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如果仅仅需要查询软删除的数据，可以使用：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">onlyTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">onlyTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="delete-方法"><a href="#delete-方法" class="header-anchor">#</a> delete()方法</h3> <p>delete()方法也可以实现软删除，此方法需要<strong>实例化调用</strong>，返回boolean值，使用时必须先获得某条字段的数据。</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">//获取字段的数据</span>
<span class="token variable">$user</span><span class="token operator">=</span><span class="token class-name static-context">UserModel</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>；
<span class="token variable">$user</span><span class="token operator">=</span><span class="token class-name static-context">UserModel</span><span class="token operator">::</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'='</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 软删除</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 真实删除</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="获取数据"><a href="#获取数据" class="header-anchor">#</a> 获取数据</h3> <p>默认情况下查询的数据不包含软删除数据，如果需要包含软删除的数据，可以使用下面的方式查询：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">withTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">withTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如果仅仅需要查询软删除的数据，可以使用：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">onlyTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">onlyTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="恢复被软删除的数据"><a href="#恢复被软删除的数据" class="header-anchor">#</a> 恢复被软删除的数据</h3> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token class-name static-context">User</span><span class="token operator">::</span><span class="token function">onlyTrashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/recoveryMonster/vuepress-blog/edit/master/docs/daily-learn/PHP/tp51-timestamp-autosave.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">7/19/2020, 1:09:51 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/daily-learn/CSS/css-secrets1.html" class="prev">
        CSS 揭秘学习笔记1
      </a></span> <span class="next"><a href="/daily-learn/PHP/typedance-pay-mini.html">
        php字节跳动小程序支付
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><div></div></div></div>
    <script src="/assets/js/app.cbc27ffd.js" defer></script><script src="/assets/js/2.26d918e1.js" defer></script><script src="/assets/js/28.c9b99067.js" defer></script>
  </body>
</html>
