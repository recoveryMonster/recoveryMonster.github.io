<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>从零搭建脚手架之初步认识 | 城南花已开</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/assets/logo.ico">
    <meta name="description" content="所爱隔山海，城南花已开">
    
    <link rel="preload" href="/assets/css/0.styles.6b9be157.css" as="style"><link rel="preload" href="/assets/js/app.cbc27ffd.js" as="script"><link rel="preload" href="/assets/js/2.26d918e1.js" as="script"><link rel="preload" href="/assets/js/37.7e04f937.js" as="script"><link rel="prefetch" href="/assets/js/10.8324ee53.js"><link rel="prefetch" href="/assets/js/11.b3fae781.js"><link rel="prefetch" href="/assets/js/12.2f57424d.js"><link rel="prefetch" href="/assets/js/13.a1bd9044.js"><link rel="prefetch" href="/assets/js/14.a21b9547.js"><link rel="prefetch" href="/assets/js/15.a55f5787.js"><link rel="prefetch" href="/assets/js/16.69ae7d01.js"><link rel="prefetch" href="/assets/js/17.8305f7c6.js"><link rel="prefetch" href="/assets/js/18.5f682b15.js"><link rel="prefetch" href="/assets/js/19.a8e0ad12.js"><link rel="prefetch" href="/assets/js/20.d64b0ffc.js"><link rel="prefetch" href="/assets/js/21.bb3d1ce8.js"><link rel="prefetch" href="/assets/js/22.2807caaf.js"><link rel="prefetch" href="/assets/js/23.d7d23893.js"><link rel="prefetch" href="/assets/js/24.d84de391.js"><link rel="prefetch" href="/assets/js/25.028292c4.js"><link rel="prefetch" href="/assets/js/26.e48e58fe.js"><link rel="prefetch" href="/assets/js/27.81a50ac9.js"><link rel="prefetch" href="/assets/js/28.c9b99067.js"><link rel="prefetch" href="/assets/js/29.3e398b0e.js"><link rel="prefetch" href="/assets/js/3.bf921ca6.js"><link rel="prefetch" href="/assets/js/30.eda8afc0.js"><link rel="prefetch" href="/assets/js/31.4df929c1.js"><link rel="prefetch" href="/assets/js/32.883b799d.js"><link rel="prefetch" href="/assets/js/33.edff820f.js"><link rel="prefetch" href="/assets/js/34.a40dfb52.js"><link rel="prefetch" href="/assets/js/35.f84b2527.js"><link rel="prefetch" href="/assets/js/36.d9686c50.js"><link rel="prefetch" href="/assets/js/38.7e0cf189.js"><link rel="prefetch" href="/assets/js/39.06edca1d.js"><link rel="prefetch" href="/assets/js/4.01616d0a.js"><link rel="prefetch" href="/assets/js/40.556d0c76.js"><link rel="prefetch" href="/assets/js/41.9370ec30.js"><link rel="prefetch" href="/assets/js/42.efb2b09e.js"><link rel="prefetch" href="/assets/js/43.230fd681.js"><link rel="prefetch" href="/assets/js/44.f8baf234.js"><link rel="prefetch" href="/assets/js/45.9434cbfb.js"><link rel="prefetch" href="/assets/js/46.5ceab43d.js"><link rel="prefetch" href="/assets/js/47.49c5f096.js"><link rel="prefetch" href="/assets/js/48.94111e03.js"><link rel="prefetch" href="/assets/js/49.b430e466.js"><link rel="prefetch" href="/assets/js/5.103b1fc9.js"><link rel="prefetch" href="/assets/js/50.5576e684.js"><link rel="prefetch" href="/assets/js/51.868924b4.js"><link rel="prefetch" href="/assets/js/52.13030538.js"><link rel="prefetch" href="/assets/js/53.d14e23b5.js"><link rel="prefetch" href="/assets/js/54.692ba555.js"><link rel="prefetch" href="/assets/js/55.e7f4ee2b.js"><link rel="prefetch" href="/assets/js/56.b2192bd2.js"><link rel="prefetch" href="/assets/js/57.7f33c3ce.js"><link rel="prefetch" href="/assets/js/58.bebb810c.js"><link rel="prefetch" href="/assets/js/59.3bb5c8e3.js"><link rel="prefetch" href="/assets/js/6.8d2cb690.js"><link rel="prefetch" href="/assets/js/60.f7d443a1.js"><link rel="prefetch" href="/assets/js/61.03c84be3.js"><link rel="prefetch" href="/assets/js/62.4d23f330.js"><link rel="prefetch" href="/assets/js/63.9b7eb6eb.js"><link rel="prefetch" href="/assets/js/64.c9a3f7a5.js"><link rel="prefetch" href="/assets/js/65.f18871f6.js"><link rel="prefetch" href="/assets/js/66.3d2c74a6.js"><link rel="prefetch" href="/assets/js/67.df9620fc.js"><link rel="prefetch" href="/assets/js/68.4c78fe6f.js"><link rel="prefetch" href="/assets/js/69.5298627a.js"><link rel="prefetch" href="/assets/js/7.77ce0fba.js"><link rel="prefetch" href="/assets/js/70.269c5ebf.js"><link rel="prefetch" href="/assets/js/71.14b994cb.js"><link rel="prefetch" href="/assets/js/72.6e1a94ad.js"><link rel="prefetch" href="/assets/js/73.327ce2fa.js"><link rel="prefetch" href="/assets/js/74.9535cbd0.js"><link rel="prefetch" href="/assets/js/8.a85b50e1.js"><link rel="prefetch" href="/assets/js/9.f7ed37b4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6b9be157.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/logo.png" alt="城南花已开" class="logo"> <span class="site-name can-hide">城南花已开</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="日常积累" class="dropdown-title"><span class="title">日常积累</span> <span class="arrow down"></span></button> <button type="button" aria-label="日常积累" class="mobile-dropdown-title"><span class="title">日常积累</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daily-learn/JavaScript/call-apply-bind-simulator.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/daily-learn/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/daily-learn/CSS/make-talkbubble.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/daily-learn/PHP/tp51-timestamp-autosave.html" class="nav-link">
  PHP
</a></li><li class="dropdown-item"><!----> <a href="/daily-learn/Git/git-des.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/daily-learn/Scaffold/Introduction.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Scaffold
</a></li></ul></div></div><div class="nav-item"><a href="/cs-basic/" class="nav-link">
  计算机基础
</a></div><div class="nav-item"><a href="/translation/Arrays-symbols-and-realms.html" class="nav-link">
  外文翻译
</a></div> <a href="https://github.com/recoveryMonster" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="日常积累" class="dropdown-title"><span class="title">日常积累</span> <span class="arrow down"></span></button> <button type="button" aria-label="日常积累" class="mobile-dropdown-title"><span class="title">日常积累</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daily-learn/JavaScript/call-apply-bind-simulator.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/daily-learn/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/daily-learn/CSS/make-talkbubble.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/daily-learn/PHP/tp51-timestamp-autosave.html" class="nav-link">
  PHP
</a></li><li class="dropdown-item"><!----> <a href="/daily-learn/Git/git-des.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/daily-learn/Scaffold/Introduction.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Scaffold
</a></li></ul></div></div><div class="nav-item"><a href="/cs-basic/" class="nav-link">
  计算机基础
</a></div><div class="nav-item"><a href="/translation/Arrays-symbols-and-realms.html" class="nav-link">
  外文翻译
</a></div> <a href="https://github.com/recoveryMonster" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PHP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Scaffold</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/daily-learn/Scaffold/Introduction.html" aria-current="page" class="active sidebar-link">从零搭建脚手架之初步认识</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily-learn/Scaffold/Introduction.html#脚手架简介" class="sidebar-link">脚手架简介</a></li><li class="sidebar-sub-header"><a href="/daily-learn/Scaffold/Introduction.html#实现原理" class="sidebar-link">实现原理</a></li><li class="sidebar-sub-header"><a href="/daily-learn/Scaffold/Introduction.html#原理进阶" class="sidebar-link">原理进阶</a></li><li class="sidebar-sub-header"><a href="/daily-learn/Scaffold/Introduction.html#开发流程" class="sidebar-link">开发流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily-learn/Scaffold/Introduction.html#开发难点" class="sidebar-link">开发难点</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily-learn/Scaffold/Introduction.html#简易分包示例及参数解析" class="sidebar-link">简易分包示例及参数解析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daily-learn/Scaffold/Introduction.html#分包示例" class="sidebar-link">分包示例</a></li><li class="sidebar-sub-header"><a href="/daily-learn/Scaffold/Introduction.html#参数解析" class="sidebar-link">参数解析</a></li></ul></li><li class="sidebar-sub-header"><a href="/daily-learn/Scaffold/Introduction.html#本地-link-流程" class="sidebar-link">本地 link 流程</a></li></ul></li><li><a href="/daily-learn/Scaffold/LernaAndYargs.html" class="sidebar-link">从零搭建脚手架之 Lerna 和 Yargs</a></li><li><a href="/daily-learn/Scaffold/Prepare.html" class="sidebar-link">从零搭建脚手架之准备工作</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="从零搭建脚手架之初步认识"><a href="#从零搭建脚手架之初步认识" class="header-anchor">#</a> 从零搭建脚手架之初步认识</h1> <p>开发脚手架的核心目标是：提升研发效能，通过脚手架，我们可以快速初始化一个项目，无需自己从零开始一步步配置，有效提升开发体验。</p> <p>其核心价值主要是将研发过程：</p> <ul><li>自动化：项目重复代码拷贝/git操作/发布上线操作</li> <li>标准化：项目创建/git flow/发布流程/回滚流程</li> <li>数据化：研发过程数据化、系统化，使得研发过程可量化</li></ul> <h2 id="脚手架简介"><a href="#脚手架简介" class="header-anchor">#</a> 脚手架简介</h2> <p>脚手架本质是一个操作系统的客户端，它通过命令行执行，比如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>vue create vue-test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>上面命令由3个部分组成：</p> <ul><li>主命令：<code>vue</code></li> <li>command：<code>create</code></li> <li>command 的 params：<code>vue-test</code></li></ul> <h2 id="实现原理"><a href="#实现原理" class="header-anchor">#</a> 实现原理</h2> <p><img src="/scaffold/scaffold-principle.png" alt="scaffold-principle"></p> <p>脚手架执行原理如下：</p> <ul><li>当我们终端输入 <code>vue create vue-test</code></li> <li>终端解析出 <code>vue</code> 命令，并在环境变量找到 <code>vue</code> 命令</li> <li>终端根据 <code>vue</code> 命令的软链接找到实际文件 <code>vue.js</code></li> <li>通过 node 执行 <code>vue.js</code></li> <li>解析并执行 <code>command/options</code></li> <li>执行完毕，退出命令</li></ul> <p>以上面的 <code>vue-cli</code> 为例，开发脚手架主要有以下步骤：</p> <ul><li>开发 <code>npm</code> 项目，该项目中应包含一个 <code>bin/vue.js</code> 文件，并将这个项目发布到 <code>npm</code></li> <li>将 <code>npm</code> 项目安装到 <code>node</code> 的 <code>lib/node_modules</code></li> <li>在 <code>node</code> 的 <code>bin</code> 目录下配置 <code>vue</code> 软连接指向 <code>lib/node_modules/@vue/cli/bin/vue.js</code></li></ul> <p>这样我们在执行  <code>vue</code> 命令的时候就可以找到 <code>vue.js</code> 进行执行</p> <p><strong>相关问题</strong></p> <ol><li><p>为什么我们全局安装 <code>@vue/cli</code> 之后，创建项目却使用的是 <code>vue</code>。</p> <p>答： 我们可以在全局安装的 <code>/usr/local/lib/node_modules/@vue/cli</code> 文件夹中看到 <code>package.json</code> 文件中设置的 bin 字段为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">&quot;bin&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token string">&quot;vue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bin/vue.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>bin 项用来指定各个内部命令对应的可执行文件的位置。上面的意思就是 <code>vue</code> 命令对应可执行文件为 bin 子目录下的 vue.js。</p></li> <li><p>全局安装 <code>@vue/cli</code> 时发生了什么？</p> <p>答：全局安装时，首先将 <code>@vue/vli</code> 下载到 <code>/usr/local/lib/node_modules</code> 文件夹中，之后通过 <code>package.json</code> 文件中的 <code>bin</code> 字段在 <code>/usr/local/bin</code> 中定义 <code>vue</code> 命令，及其软链接的 <code>bin/vue.js</code> 文件。</p></li> <li><p>执行<code>vue</code>命令时发生了什么？为什么<code>vue</code>指向一个<code>js</code>文件，我们却可以直接通过<code>vue</code>命令去执行它？</p> <p>答：终端首先在环境变量中寻找 <code>vue</code> 指令，相当于执行 <code>which vue</code> 命令，如果没有找到该命令，则会提示 <code>command not found</code>。如果找到了注册的 <code>vue</code> 命令，则会找到其软链接的 <code>/usr/local/lib/node_modules/@vue/cli/bin/vue.js</code> 文件，去执行文件中的代码。由于文件中第一行是 <code>#!/usr/bin/env node</code>，这行代码告诉系统在环境变量找到 node，并通过 node 来执行该文件。</p></li></ol> <h2 id="原理进阶"><a href="#原理进阶" class="header-anchor">#</a> 原理进阶</h2> <p><strong>为什么说脚手架本质是操作系统的客户端？它和我们在 PC 上安装的应用/软件的区别是什么？</strong></p> <p>答：node 在 windows 中是 node.exe，在 Mac 中是可执行文件，node 在操作系统中是一个可执行文件，而脚手架的本质是通过 node 执行 JS 文件，因此其本质也是操作系统的客户端。它与 PC 上安装的应用/软件没有区别，都是客户端，一个提供了 GUI 来方便操作，一个是命令行形式操作。</p> <p>我们如果想为某个命令创建别名，可以在别名上增加软链接指向原命令，如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>ln <span class="token operator">-</span>s  <span class="token function">指向的文件路径</span><span class="token punctuation">(</span>指令<span class="token punctuation">)</span> 软连接名称
ln <span class="token operator">-</span>s <span class="token punctuation">.</span><span class="token operator">/</span>vue vue2

<span class="token comment">// 创建之后</span>
lrwxr<span class="token operator">-</span>xr<span class="token operator">-</span>x  <span class="token number">1</span> xxx  admin    <span class="token number">39</span>B  <span class="token number">2</span>  <span class="token number">7</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">56</span> vue <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>lib<span class="token operator">/</span>node_modules<span class="token operator">/</span>@vue<span class="token operator">/</span>cli<span class="token operator">/</span>bin<span class="token operator">/</span>vue<span class="token punctuation">.</span>js
lrwxr<span class="token operator">-</span>xr<span class="token operator">-</span>x  <span class="token number">1</span> xxx  admin     <span class="token number">5</span>B  <span class="token number">5</span>  <span class="token number">3</span> <span class="token number">01</span><span class="token operator">:</span><span class="token number">11</span> vue2 <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">.</span><span class="token operator">/</span>vue
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>脚手架执行全过程流程图</p> <p><img src="/scaffold/scaffold-run.png" alt="scaffol-run"></p> <h2 id="开发流程"><a href="#开发流程" class="header-anchor">#</a> 开发流程</h2> <p>开发一个脚手架最简单的流程如下所示：</p> <ol><li>创建项目，并使用 <code>npm init</code> 初始化项目</li> <li>创建脚手架入口文件，并在第一行中添加 <code>#!/usr/bin/env node</code></li> <li>配置 package.json 文件，添加 bin 属性</li> <li>编写并将脚手架发布</li></ol> <h3 id="开发难点"><a href="#开发难点" class="header-anchor">#</a> 开发难点</h3> <ul><li><p>分包：即将复杂的系统分成若干个小模块</p></li> <li><p>命令注册：如 vue-cli 中</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>vue create
vue <span class="token function">add</span>
vue invoke
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>参数解析</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>vue <span class="token builtin class-name">command</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token operator">&lt;</span>params<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><p>options 全称：<code>--version</code>、<code>--help</code></p></li> <li><p>options 简写：<code>-V</code>、<code>-h</code></p></li> <li><p>带 params 的 options：<code>--git initial commit</code></p></li> <li><p>帮助文档：</p> <ul><li>global help
<ul><li>Usage</li> <li>Options</li> <li>Commands</li></ul></li></ul> <p>示例：<code>vue</code> 的帮助信息：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Usage: vue <span class="token operator">&lt;</span>command<span class="token operator">&gt;</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span>

Options:
  -V, --version                              output the version number
  -h, --help                                 output usage information

Commands:
  create <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token operator">&lt;</span>app-name<span class="token operator">&gt;</span>                create a new project powered by vue-cli-service
  <span class="token function">add</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token operator">&lt;</span>plugin<span class="token operator">&gt;</span> <span class="token punctuation">[</span>pluginOptions<span class="token punctuation">]</span>     <span class="token function">install</span> a plugin and invoke its generator <span class="token keyword">in</span> an already created project
  invoke <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token operator">&lt;</span>plugin<span class="token operator">&gt;</span> <span class="token punctuation">[</span>pluginOptions<span class="token punctuation">]</span>  invoke the generator of a plugin <span class="token keyword">in</span> an already created project
  inspect <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>paths<span class="token punctuation">..</span>.<span class="token punctuation">]</span>               inspect the webpack config <span class="token keyword">in</span> a project with vue-cli-service
  serve <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>entry<span class="token punctuation">]</span>                    serve a .js or .vue <span class="token function">file</span> <span class="token keyword">in</span> development mode with zero config
  build <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>entry<span class="token punctuation">]</span>                    build a .js or .vue <span class="token function">file</span> <span class="token keyword">in</span> production mode with zero config
  ui <span class="token punctuation">[</span>options<span class="token punctuation">]</span>                               start and <span class="token function">open</span> the vue-cli ui
  init <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token operator">&lt;</span>template<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>app-name<span class="token operator">&gt;</span>       generate a project from a remote template <span class="token punctuation">(</span>legacy API, requires @vue/cli-init<span class="token punctuation">)</span>
  config <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>value<span class="token punctuation">]</span>                   inspect and modify the config
  outdated <span class="token punctuation">[</span>options<span class="token punctuation">]</span>                         <span class="token punctuation">(</span>experimental<span class="token punctuation">)</span> check <span class="token keyword">for</span> outdated vue cli <span class="token function">service</span> / plugins
  upgrade <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>plugin-name<span class="token punctuation">]</span>            <span class="token punctuation">(</span>experimental<span class="token punctuation">)</span> upgrade vue cli <span class="token function">service</span> / plugins
  migrate <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>plugin-name<span class="token punctuation">]</span>            <span class="token punctuation">(</span>experimental<span class="token punctuation">)</span> run migrator <span class="token keyword">for</span> an already-installed cli plugin
  info                                       print debugging information about your environment

  Run vue <span class="token operator">&lt;</span>command<span class="token operator">&gt;</span> --help <span class="token keyword">for</span> detailed usage of given command.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li></ul></li></ul> <p>还有如：</p> <ul><li>命令行交互</li> <li>日志打印</li> <li>命令行文字变色</li> <li>文件处理等</li></ul> <h2 id="简易分包示例及参数解析"><a href="#简易分包示例及参数解析" class="header-anchor">#</a> 简易分包示例及参数解析</h2> <p>首先我们通过 <code>npm init</code> 初始化一个 <code>recovery-cli</code> 项目，然后在 package.json 文件中添加 <code>bin</code> 字段如下：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;bin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;recovery-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bin/index.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>然后我们在该项目下新建 <code>bin/index.js</code> 文件，并编写如下代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>为了可以使用 <code>recovery-cli</code> 命令，我们可以有如下两种方法：</p> <ol><li><p>先通过 <code>npm publish</code> 发布，然后 <code>npm install -g recovery-cli</code> 全局安装该项目，之后就可以直接使用 <code>recovery-cli</code></p></li> <li><p>在开发中，我们更推荐该方法，通过使用 <code>npm link</code> 命令，将 <code>recovery-cli</code> 注册到全局命令，然后软链接到本地项目，如下所示：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>// /usr/local/bin 目录中查看命令软链接
lrwxr-xr-x  <span class="token number">1</span> root  admin    45B  <span class="token number">5</span>  <span class="token number">3</span> <span class="token number">11</span>:31 recovery-cli -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/lib/node_modules/recovery-cli/bin/index.js
// /usr/local/lib/node_modules 目录 
lrwxr-xr-x   <span class="token number">1</span> root  wheel    55B  <span class="token number">5</span>  <span class="token number">3</span> <span class="token number">11</span>:31 recovery-cli -<span class="token operator">&gt;</span> <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/Users/fengliu/Desktop/test-cli/recovery-cli
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ol> <h3 id="分包示例"><a href="#分包示例" class="header-anchor">#</a> 分包示例</h3> <p>我们新建并初始化一个库文件夹 <code>recovery-lib</code>，之后在 package.json 文件中 <code>main</code> 字段指定该项目的入口文件：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lib/index.js&quot;</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后在该项目 <code>lib/index.js</code> 文件中编写如下代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">multi</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  sum<span class="token punctuation">,</span>
  multi<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>然后通过在该项目使用 <code>npm link</code> 将该模块添加到全局 node_modules 中，这时我们在进入到 <code>recovery-cli</code> 主项目中，通过 <code>npm link recovery-lib</code> 中，从而将该模块中 node_modules 下指定库文件链接到全局 node_modules 文件夹。同时在主目录中的 package.json 文件中添加如下代码</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;recovery-lib&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>之后在 <code>recovery-cli</code> 主目录下执行 <code>npm install</code> 进行依赖安装，并在 <code>bin/index.js</code> 文件中，添加如下代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> sum<span class="token punctuation">,</span> multi <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;recovery-lib&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;2 + 3 =&quot;</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;2 * 4 =&quot;</span><span class="token punctuation">,</span> <span class="token function">multi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这时我们运行 <code>recovery-cli</code> 命令，可以看到命令行中输出如下代码，即表明简单的分包已经完成：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hello world
2 + 3 = 5
2 * 4 = 8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="参数解析"><a href="#参数解析" class="header-anchor">#</a> 参数解析</h3> <p>我们首先在 <code>recovery-cli</code> 主目录中添加 <code>bin/command.js</code> 文件，其中代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> option<span class="token punctuation">,</span> param <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;执行 init 流程&quot;</span><span class="token punctuation">,</span> option<span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  init<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>然后我们在 <code>bin/index.js</code> 文件中引入，并进行简单的相关参数解析，代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> args <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>command<span class="token punctuation">,</span> userOption <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> param<span class="token punctuation">]</span> <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>command<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>commandFun<span class="token punctuation">[</span>command<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> option <span class="token operator">=</span> userOption<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">--|-</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    commandFun<span class="token punctuation">[</span>command<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">{</span> option<span class="token punctuation">,</span> param <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果是全局选型 --version -V</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;--&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> command<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> gloabOption <span class="token operator">=</span> command<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">--|-</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>gloabOption <span class="token operator">===</span> <span class="token string">&quot;version&quot;</span> <span class="token operator">||</span> gloabOption <span class="token operator">===</span> <span class="token string">&quot;V&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>version<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;无效的命令&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;请输入命令&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>然后我们在命令行中，输入以下命令，可以看到输出的结果如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>~/Desktop/test-cli/recovery-cli » recovery-cli init --name <span class="token builtin class-name">test</span>
hello world
<span class="token number">2</span> + <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">5</span>
<span class="token number">2</span> * <span class="token number">4</span> <span class="token operator">=</span> <span class="token number">8</span>
执行 init 流程 name <span class="token builtin class-name">test</span>
~/Desktop/test-cli/recovery-cli » recovery-cli -V
hello world
<span class="token number">2</span> + <span class="token number">3</span> <span class="token operator">=</span> <span class="token number">5</span>
<span class="token number">2</span> * <span class="token number">4</span> <span class="token operator">=</span> <span class="token number">8</span>
<span class="token number">1.0</span>.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>以上简单的命令解析已经完成，但实际上的命令及选项和参数远比这个复杂，这里只是简单的模拟。</p> <h2 id="本地-link-流程"><a href="#本地-link-流程" class="header-anchor">#</a> 本地 link 流程</h2> <p><strong>新建&amp;连接本地脚手架</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> recovery-cli
<span class="token builtin class-name">cd</span> erdan-test
<span class="token function">npm</span> init -y
<span class="token function">npm</span> <span class="token function">link</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>新建本地库文件并在本地脚手架中使用</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> recovery-lib
<span class="token builtin class-name">cd</span> recovery-lib
<span class="token function">npm</span> init -y
<span class="token function">npm</span> <span class="token function">link</span>
<span class="token builtin class-name">cd</span> recovery-cli
<span class="token function">npm</span> <span class="token function">link</span> recovery-lib
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>取消链接本地库文件</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> recovery-lib
<span class="token function">npm</span> unlink
<span class="token builtin class-name">cd</span> recovery-cli
<span class="token comment"># link存在的情况下执行下面这行</span>
<span class="token function">npm</span> unlink recovery-lib
<span class="token comment"># link不存在的情况下删除node_modules</span>
<span class="token comment"># 从安装发布到远程仓库上的库文件</span>
<span class="token function">npm</span> i -S recovery-lib
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/recoveryMonster/vuepress-blog/edit/master/docs/daily-learn/Scaffold/Introduction.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/daily-learn/Git/git-time-machine.html" class="prev">
        Git时光穿梭机
      </a></span> <span class="next"><a href="/daily-learn/Scaffold/LernaAndYargs.html">
        从零搭建脚手架之 Lerna 和 Yargs
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><div></div></div></div>
    <script src="/assets/js/app.cbc27ffd.js" defer></script><script src="/assets/js/2.26d918e1.js" defer></script><script src="/assets/js/37.7e04f937.js" defer></script>
  </body>
</html>
